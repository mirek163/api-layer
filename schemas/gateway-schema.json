{
    "$schema": "https://json-schema.org/draft/2019-09/schema",
    "$id": "https://zowe.org/schema/gateway-config",
    "allOf": [
        { "$ref": "https://zowe.org/schemas/v2/server-base" },
        {
            "type": "object",
            "properties": {
                "components": {
                    "type": "object",
                    "additionalProperties": true,
                    "properties": {
                        "gateway-service": {
                            "allOf": [
                                {"$ref":  "https://zowe.org/schemas/v2/server-base#zoweComponent"},
                                {
                                    "type": "object",
                                    "properties": {
                                        "port": {
                                            "$ref": "#/$defs/port",
                                            "default": 7553
                                        },
                                        "debug": {
                                            "type": "boolean",
                                            "description": "Enable debug logs in gateway service"
                                        },
                                        "heap": {
                                            "type": "object",
                                            "description": "Configure JVM parameters for heap size",
                                            "properties": {
                                                "init": {
                                                    "type": "integer",
                                                    "description": "Initial heap size in MB."
                                                },
                                                "max": {
                                                    "type": "integer",
                                                    "description": "Maximum heap size in MB."
                                                }
                                            }
                                        },
                                        "apiml": {
                                            "type": "object",
                                            "description": "Zowe API ML specific properties.",
                                            "properties": {
                                                "service": {
                                                    "type": "object",
                                                    "properties": {
                                                        "allowEncodedSlashes": {
                                                            "type": "boolean",
                                                            "description": "Allow URLs on gateway to contain encoded slashes.",
                                                            "default": true
                                                        },
                                                        "additionalRegistration": {
                                                            "type": "array",
                                                            "description": "List of additional Discovery Services URLs to register with and the routing patterns.",
                                                            "minItems": 1,
                                                            "items": {
                                                                "type": "object",
                                                                "properties": {
                                                                    "discoveryServiceUrls": {
                                                                        "type": "string",
                                                                        "description": "List of Discovery Services URLs in one security domain. You can separate multiple urls by comma or semicolon."
                                                                    },
                                                                    "routes": {
                                                                        "$ref": "#/$defs/routes"
                                                                    }
                                                                },
                                                                "required": ["discoveryServiceUrls","routes"]
                                                            }
                                                        },
                                                        "corsEnabled": {
                                                            "type": "boolean",
                                                            "description": "Allow CORS on gateway.",
                                                            "default": true
                                                        }
                                                    }
                                                }
                                            }
                                        },
                                        "server": {
                                            "type": "object",
                                            "description": "Configure gateway server properties.",
                                            "properties": {
                                                "maxConnectionsPerRoute": {
                                                    "type": "integer",
                                                    "description": "How many connection should exists for single HTTP client?",
                                                    "default": 100
                                                },
                                                "maxTotalConnections": {
                                                    "type": "integer",
                                                    "description": "How many connection should exists in total?",
                                                    "default": 1000
                                                },
                                                "webSocket": {
                                                    "type": "object",
                                                    "description": "Customize websocket server parameters",
                                                    "properties": {
                                                        "maxIdleTimeout": {
                                                            "type": "integer",
                                                            "description": "The gateway acts as a server and client. This parameters customizes the default idle timeout for its client role.",
                                                            "default": 3600000
                                                        },
                                                        "connectTimeout": {
                                                            "type": "integer",
                                                            "description": "The gateway acts as a server and client. This parameters customizes the default connect timeout for its client role.",
                                                            "default": 15000
                                                        },
                                                        "stopTimeout": {
                                                            "type": "integer",
                                                            "description": "The gateway acts as a server and client. This parameters customizes the default stop timeout for its client role.",
                                                            "default": 30000
                                                        },
                                                        "asyncWriteTimeout": {
                                                            "type": "integer",
                                                            "description": "The gateway acts as a server and client. This parameters customizes the default async write timeout for its client role.",
                                                            "default": 60000
                                                        }
                                                    }
                                                },
                                                "ssl": {
                                                    "type": "object",
                                                    "description": "Network encryption for gateway service connections.",
                                                    "properties": {
                                                        "enabled": {
                                                            "type": "boolean",
                                                            "description": "Should gateway use encrypted communication?",
                                                            "default": true
                                                        }
                                                    }
                                                }

                                            }
                                        },
                                        "spring": {
                                            "type": "object",
                                            "description": "Application framework parameters",
                                            "properties": {
                                                "profiles": {
                                                    "type": "object",
                                                    "description": "Profiles that can hold multiple configuration parameters.",
                                                    "properties": {
                                                        "active": {
                                                            "type": "string",
                                                            "description": "List of the active configuration profiles."
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            ]
                        }
                    }
                }
            }
        }
    ],
    "$defs": {
        "port": {
            "type": "integer",
            "description": "TCP network port",
            "minimum": 1024,
            "maximum": 65535
        },
        "routes": {
            "type": "array",
            "description": "Routing parameters",
            "items": {
                "type": "object",
                "properties": {
                    "gatewayUrl": {
                        "type": "string",
                        "description": "The portion of the gateway URL which is replaced by the serviceUrl path."
                    },
                    "serviceUrl": {
                        "type": "string",
                        "description": "The portion of the service instance URL path which replaces the gatewayUrl part."
                    }
                },
                "required": ["gatewayUrl","serviceUrl"]
            }
        }
    }
}
